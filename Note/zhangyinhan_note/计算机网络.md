# 概述

## 网络的网络

计算机网络由若干结点和连接这些结点的链路组成的

结点：由计算机、集线器、交换机或路由器等组成的

* 网络把许多计算机连接到一起，与网络相连的计算机叫做主机
* 互连网通过路由器，把许多的网络连接到了一起



### 发展阶段

> 概念区分：
>
> 互连网（internet）：指由多个计算机网络连接起来的网络
>
> 互联网（Internet）: 指全球最大的、由众多网络连接起来的特定互连网，采用TCP/IP协议，作为通信规则 

第一阶段：单个分组交换网络arpanet  ，TCP/IP协议成为arpanet的标准协议

第二阶段： 三级结构的互联网 --- 主干网、地区网、校园网（企业网）

第三阶段：多层次ISP结构的互联网。 Internet Service Provider

互联网交换点（IXP）Internet Exchange Piont：允许两个网络直接相连并交换分组，不需要第三个网络来转发分组。

> IXP的结构非常复杂，经典的IXP由一个或者多个网络交换机组成，许多ISP再连接到网络交换机的相关端口上





## 互联网的组成

### 边缘部分

由所有连接在因特网上的主机构成，这部分由用户直接使用，用来连接通讯、传送数据和资源共享的

* 端系统：就是主机
* 进程：运行中的程序

主机A和主机B进行通信：主机A上的某个进程和主机B上的某个进程进行通信  ---**计算机之间的通信**



端系统之间的通信分为两大类： 客户--服务器 （CS方式） 和 对等方式（P2P）



#### 客户--服务器方式

> 概念：
>
> 客户：指运行客户程序的机器
>
> 用户：使用计算机的人
>
> 服务器：运行服务器程序的机器

客户和服务器指的通信中所涉及到的两个应用进程 ，客户是服务请求方，服务器是服务提供方。

客户向服务器发送请求，服务器为客户提供服务

* 客户程序：

  1.被用户调用后运行，向服务器发送请求，因此客户程序必须最大服务器的地址

  2.不需要特殊的硬件和复杂的操作系统

* 服务器程序：

  1.一种专门提供服务的程序，可以同时处理多个远地或本地客户请求

  2.系统启动后就一直自动调用并一直运行着，被动的等待客户发送请求，不需要知道客户程序的地址



#### 对等连接（P2P）

两台主机在通信时不区分哪一个是服务请求方哪一个是服务提供方。

两台主机都要运行对等连接的软件（P2P软件）就可以对等通信

* 本质上也是客户-服务器方式

* 对等连接工作方式支持大量对等用户同时工作，上百万个都行



### 核心部分

由大量的网络和连接这些网络的路由器组成，这部分是为边缘部分提供服务的（提供联通性和交换），使得边缘部分任意一台主机都能向其他主机通信。

* 路由器：是一种专用的计算机，实现分组交换的重要组件，其任务就是暂时储存然后转发收到的分组。
* 工作过程：路由器先收到分组放入缓存，查转发表，应该把这个分组发给哪一个路由器，然后转发

#### 电路交换

用打电话的例子理解





* 交换：按照某种方式动态地分配传输线路上的资源。

电路交换的过程：

建立连接（占用通信资源）--> 通话（一直占用通信资源）--> 释放资源（归还通信资源）

* 特点：在通话的全部时间内，通话的两个用户始终占用端到端的通信资源
* 突发式、效率低

计算机数据式突发式的出现在传输线路上的，已被占用的通信线路绝大部分时间都是空闲的。

例如：计算机之间建立连接之后，用户在阅读屏幕上的信息，键盘输入文件时，计算机正在处理而结果还没返回时，这中间的所有时间都占用着通信资源



#### 分组交换

分组交换采用 储存转发技术： 一个报文就是我们要发送的一整块数据，把一个报文划分为几个等长的数据段之后再进行传送。

> 每一个数据段的前面再加上一些必要的控制信息组成头部后，就成为了一个分组。
>
> 头部：包含 目的地址、源地址、转发表等重要控制信息

负载均衡：一个分组在传送的过程中，链路的通信量太大，那么路由器可以把分组沿另一个路由器传送，走其他的路径，最后到达终点

* 每一个分组都可以独立的选择传输路径最后到达传输的终点就行

分组在发送过程中只占用正在发送中的那一段链路，整个路径上的其他链路并不占用，这样一段一段的断续发送，省去了建立连接和释放连接的开销，数据传输效率更高。

分组转发的优点：

1.高效：在分组传输过程中动态分配带宽，对通信链路逐段占用

2.灵活：为每一个分组独立的选择最合适的转发路由

3.迅速：以分组作为传送单位，可以不先建立连接就能向其他的主机发送分组

4.可靠：保证可靠性的网络协议：分布式多路由的分组交换网络，生存性高

缺点：

1.分组在路由器进行转发的时候，需要排队，会造成时延

2.无法保证通信时端到端所需的带宽

3.各分组所携带的控制信息造成了一定的开销，整个分组交换网还需要专门的管理和控制机制



三种交换方式：电路交换、报文交换、分组交换

电路交换：整个报文必须连续的从源点直达终点

报文交换：整个报文先传送到相邻节点，全部储存下来后查找转发表，转发到下一个结点

分组交换：单个分组传送到相邻结点，储存下来后查找转发表，转发到下一个结点

![Screenshot_20220226_151926](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220226_151926.jpg)



### 计算机性能指标

#### 速率：

单位：bit/s

一个比特就是一个1或者0

```
k = 10^3 ,M = 10^6 ,G = 10^9 , T = 10^ 12 

2^10 = 1024

1KB = 1024 B
1M = 1024 KB 
B是字节，1B = 8bit
```



#### 带宽：

1.指某个信号具有的频带宽度。单位是hz

2.计算机网络中，带宽用来表示某通道传送数据的能力，因此网络带宽表示：单位时间内网络中某通信通道所能通过的最高数据率。单位是bit/s



#### 吞吐量

表示单位时间内通过某个网络的实际数据量



#### 时延

指数据（一个报文或者分组，甚至是比特）从网络的一端传送到另一端所需的时间

* 发送时延：是主机或者路由器发送数据帧所需的时间。从发送数据帧的第一个比特算起，一直到最后一个比特发送完毕所需要的时间。

  发送时延等于 = 数据帧长度/发送速率

* 传播时延：电磁波在信道中传播一定的距离所需要的时间。

  传播时延 = 信道长度(m)/电磁波在信道上传播速率（m/s）

* 处理时延：

  主机或者路由器收到分组时需要花费一定的时间进行处理，例如分析首部、从分组中提取数据

* 排队时延：

  分组在进入路由器后，需要在输入队列中等待转发，路由器确定了转发接口后，还要进入输出队列进行排队，这就产生了排队时延。

  排队时延的长短取决于网络的通信量，网络通信量很大时，就会发生队列溢出，使分组丢失。

* 时延带宽积：

  时延带宽积管道表示传输链路

  传播时延* 带宽 这代表链路的圆柱形管道，管道的长度就是传播时延，管道的截面积就是带宽

  ![Screenshot_20220310_141426](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220310_141426.jpg)

* 往返时间RTI：

  因特网上的信息不仅仅是单方向传播，而是双方向交互的。因此我们需要知道双方交互的时间。

  ```
  例如：A向B发送100MB的数据，经过发送时间，B收到数据，然后向A发送确认收到信息，A才能继续发送信息。
  显然这个确认信息，需要等待一个往返的时间。所以，发送数据率计算时要加上这个等待时间RTI
  有效发送数据率 = 数据长度/发送时间+RTI
  ```

* 利用率：

  * 信道利用率：某信道有百分之几的时间是被利用的（有数据通过），空闲的信道利用率为0.
  * 网络利用率：全网络信道利用率的加权平均值。

  信道利用率并不是越高越好哦！ 很多数据都在这个用信道，那肯定会造成堵车，要排队，时延就会提高。

### 易错区分

通信网络是保证网络的可靠性来保证数据传输的可靠性，代价非常昂贵（昂贵的交换机和网管系统）

而计算机网络没有采用，因为耗费巨大

计算机网络传输数据的过程中本来就不可靠，有很多个环节都有可能导致数据的丢失，而且计算机网络的终端设备都是智能的，我们把数据传输网设置的简单一些，让智能的终端来完成使终端传输变得可靠的任务。

> 端到端的可靠传输：
>
> 主机A向主机B发送数据，只要主机B发现主机A发送的数据有差错，就告诉主机A把出现差错的那部分数据重新传送，直到这部分传输对为止！

传播速率与传输速率：

> 速度的单位是m/s，速度提升指在单位时间内通过的距离增大了
>
> 网络中的速度，单位bit/s，指计算机单位时间内向所连接的媒体或网络发送了多少个比特

* 要提高传输速率     1. 用更好的传输媒体  	2.使用先进的调制技术

时延：

> 发送时延 = 传输时延 ！= 传播时延



![Screenshot_20220310_135445](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220310_135445.jpg)

> 可以，但是一定不能认为提高信道的传输速率是设法使更多的比特并行的传输。
>
> 低速信道相当于汽车进入信道的间隔变长，比如每隔一分钟进入一辆车
>
> 高速信道相当于每隔6秒进入一辆车
>
> 汽车行驶的速度没有变，但同样的时间内进入告诉公路的车的数量变多了，因而吞吐量变大了
>
> 
>
> 链路的带宽提高10倍，1s能发送以前10倍的数据，显然发送速率提高了，然而这些比特的传输效率并没有提高



分组交换的名字：

数据链路层：这样的数据单元叫做  帧

网络层：叫做IP数据报

运输层：TCP报文段 /UDP数据报



### 协议

> 计算机网络中要做到有条不紊的交换数据，就必须遵守事先约定好的规则。这些规则明确规定了所交换的数据的格式以及有关的同步的问题。
>
> **为进行网络中的数据交换问题而建立的规则标准或约定称为网络协议**

语法：即数据与控制信息的结构或格式

语义：即需要发出何种控制信息，完成何种动作以及做出何种响应

同步：即事件实现顺序的详细说明





### 分层

分层的好处：

* 各层之间独立。不需要知道上下层之间的结构，只需要知道层间的接口，处理问题就简单了。
* 灵活性好。某一层发生变化时，上层和下层不受影响
* 结构上可分隔开
* 易于实现和维护
* 能促进标准化工作

缺点：某些功能反复在不同的层次中出现，造成额外的开销。



OSI是一个七层的体系结构（复杂且不实用）

TCP/IP是一个四层的网络层次。应用层、运输层、网际层、网络接口层。

我们采用五层的体系：应用层、运输层、网络层、数据链路层、物理层



####  应用层

>  应用层的任务是通过 应用进程之间的交互来完成特点网络应用。

应用层协议定义的就是应用程序间的通信和交互的规则

应用层协议举例：域名系统DNS，支持万维网应用的HTTP协议 ，电子邮件的SMTP协议

应用层交互的单元称为报文。



#### 运输层

> 运输层的任务是 负责向两台主机进程之间通信提供通用的数据传输服务。
>
> 应用程序通过运输层服务传送应用层的报文，多种应用可以同时使用一个运输层
>
> 一台主机可以运行多个进程，因此运输层存在复用和分用。
>
> 复用：多个应用层程序可同时使用下面的运输层的服务。
>
> 分用：把运输层收到的信息交付到上面的应用层

运输层主要有两种协议：TCP协议，UDP协议

##### TCP协议

传输控制协议，提供面向连接的、可靠的数据传输服务，单位是报文段



##### UDP协议

用户数据报协议，提供无连接的，尽最大努力的数据传输服务（不保证数据传输的安全性），其运输单位是用户数据报

TCP和IP协议并不是单指TCP和IP这两个协议，而是表示因特网所使用的整个TCP和IP协议族



#### 网络层

>  网络层负责为分组交换网上的不同主机提供通信服务。
>
> 在发送数据的时候，网络层把传输层传下来的报文段或者用户数据报，分装成分组进行传送
>
> 在TCP/IP体系中，网络层使用IP协议，所以分组又称为IP数据报
>
> * 注意网络层的IP数据报，和传输层的UDP数据报不要弄混了



#### 数据链路层

> 两台主机之间的数据传输，总是在一段一段的链路上传送的，这需要使用专门的链路层协议。



发送过程：链路层接收网络层的IP数据报组装成帧，在两个相邻节点之间传送帧，每一帧包括数据和控制信息（包括同步信息、地址信息、差错控制等）

接收过程：接收数据时，控制信息使接收端知道，一个帧从哪一个bit开始到哪一个bit结束。这样接收端的链路层就可以提取出帧中的数据交到网络层中



#### 物理层

> 传输单位是bit 。

> 物理层考虑的是多大的电压代表1，多大的电压代表0 ，还有接收方如何识别发送方所发送的比特。
>
> 物理层还要确定连接电缆的插头应当有多少个引脚和各引脚如何连接。
>
> 不需要知道比特代表什么意思，而且物理媒体（电缆，光缆等）的协议不在物理层协议里，而是在物理层下面的协议里面。



#### 数据在各层的传输过程：

![IMG_20220303_144135_edit_41061672646156](D:%5CHuawei%20Share%5CHuawei%20Share%5CIMG_20220303_144135_edit_41061672646156.jpg)

> 主机1的应用进程AP1向主机2的应用进程AP2传送数据。
>
> 发出过程：
>
> 1. AP1先将数据交给应用层，应用层加上必要的控制信息H5,变成下一层的数据单元
> 2. 传输层接收到数据单元，再加上必要的控制信息H4，再交给网络层
> 3. 网络层接收到这个数据单元后，再加上控制信息H3，交给数据链路层
> 4. 数据链路层，控制信息H2被分为两部分，一部分加到头部，一部分加到尾部
> 5. 而物理层，只进行比特流的传送，所以不再加上控制信息
>
> 传送比特流时，必须从首部开始传送
>
> 路由器转发过程：
>
> 1. 路由器接收到数据后，每一层都将必要的控制信息剥去，将剩下的数据信息交给上一层
> 2. 分组到达第三层时，路由器就根据分组首部中的目的地址查找路由器中的转发表，找出转发分组的接口，然后往下传
> 3. 往下到达第二层之后，再加上首部和尾部的控制信息，再到最下面的第一层，然后再物理媒体上发出去
>
> 接收过程：
>
> 与发送过程相反，一层一层剥去控制信息，依次上升到第5层应用层，把数据交给应用进程AP2

这个复杂的传送过程，用户看不见，就像AP1直接把数据发给AP2，水平虚线对应的就是对等层。









# 物理层

> 物理层考虑的怎样才能连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。
>
> * 物理传输媒体的种类非常多，通信手段也有很多，物理层的作业就是尽可能的屏蔽掉传输媒体和通信手段的差异，使物理层上面的数据链路层感觉不到差异。

物理的主要任务描述为  **确定与传输媒体的接口相关的一些特性**

1. 机械特性：指明接口所用的接线器的形状和尺寸、引脚数目和排列、固定、锁定装置等。
2. 电器特性：指明接口电缆的各条线上出现的电压范围
3. 功能特性：某条线上出现的某一电平的电压的意义
4. 过程特性：不同功能的各种可能事件的出现顺序

数据在计算机内部大多使并行传输，在通信线路中是串行传输

## 数据通信系统

三部分组成：源系统（发送端）、传输系统（传输网络）、目的系统（接收端）

源系统：

> 1. 源点：源点设备产生要传输的数据。例如键盘输入的数据
> 2. 发送器：源点产生的数字比特流要通过发送器进行编码后，才能够在传输系统中进行传输
> 3. 接收器：接收传输系统发送过来的信号，转化为能被目的设备处理的信息。
> 4. 终点：把从接收器接收的数字比特流，在屏幕上显示出来

概念：

> * 消息：如文字、语音、图像等，都是消息。
> * 数据：是运送消息的实体，即以特定的方式表示的信息，通常是有意义的符号序列。
> * 信号：数据的电气或这电磁的表现
>   * 模拟信号：连续信号，消息的取值是连续的。
>   * 数字信号：离散信号：消息的参数值是离散的。离散值的波形称为码元，二进制的码元就是0/1



信道：

> 指向某个方向传送信息的媒体。 一条信道包括一条发送信道，一条接收信道。
>
> 通信的三种信息交互方式：
>
> 1. 单向通信：单工通信，只能有一个方向的通信而没有反方向的交互。例如，无线电广播，电视广播
> 2. 双向交替通信：半双工通信（以太网），通信的双方都可以发送信息，但是不能双方同时发送（也不能同时接收），这种方式就是一方发送，一方接收，过一段时间可以反过来。
> 3. 双向同时通信：全双工通信（交换机），通信的双方可以同时发送和接受消息。
>
> 基带信号：
>
> 计算机文字、语音、图像文件的数据信号都是基带信号。没有任何的加工，由计算机发出。
>
> 但是许多信道无法传输基带信号，这就需要调制！
>
> 调制：
>
> 1. 基带调制：对基带的波形进行变换，使它能够与信道特性相适应，变换后的信号还是基带信号。其实就是把数字信号转换为另一种数字信号，也就是**编码**
> 2. 带通调制：使用载波将低频信号转换到高频，且转换为模拟信号。



编码方式：

> ![IMG_20220303_155614_edit_41252306364000](D:%5CHuawei%20Share%5CHuawei%20Share%5CIMG_20220303_155614_edit_41252306364000.jpg)
>
> * 不归零制：正电平代表1，负电平代表0
> * 归零制：正脉冲代表1，负脉冲代表0
> * 曼彻斯特编码：位周期中心的向上跳变代表0，向下跳变代表1
> * 差分曼彻斯特编码：每一位中心始终都有跳变，位开始边界跳变代表0，没有跳变代表1
>
> 

带通调制方法：

![Screenshot_20220310_162221](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220310_162221.jpg)





信道的极限容量：

> 数据传输不可能以任意高的速率进行传输。
>
> 数字通信的优点：虽然信号在信道上传输不可避免的产生失真，但是在接收端只要我们从失真的波形中能识别出原来的信号，那么这种失真就没有影响。
>
> 码元传输速率越高，或信号传输的距离越远，干扰噪声越大，传输媒体越差，波形失真越严重。
>
> ![Screenshot_20220310_162440](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220310_162440.jpg)
>
> 限制码元的传输速率主要有以下两个：
>
> 1. 信道能通过的频率范围：
>
> 高频率的信号，通过比它低的信道，高频分量就要衰减，波形的前沿和后延开始拖拉延长，波形收到影响，严重的就会失去码元之间区分的界限，这叫做**码间串扰**
>
> * 码元的传输速率有上限，超过了上限就有严重的码间串扰问题，识别码元就不可能
>
> 2. 信噪比 
>
> 信号的平均功率与噪声的平均功率之间的比值，S/N ,分贝作为度量单位（dB）
>
> 信噪比 = 10 log10(S/N) dB
>
> 香农公式： 极限信息传输速率： C = W log2(1+S/N)  (bit/s)     W为带宽
>
> 公式的意义：只要信息的极限传送速率低于信道的极限速率，就一定存在某种方式实现无差错的传输
>
> 

传输媒体：

双绞线-->同轴光缆 -->光纤



信道复用：

> 简单来说，就是多个单独传输的信道通过复用器合到一起，然后采用一个共享的信道传输，再采用分用器将不同的信道分开，再分别到达自减的终点。
>
> ![Screenshot_20220310_162733](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220310_162733.jpg)

频分复用：

> 用户在分配到一定的频道后，在通信的过程中自始至终都占用这个频带。所有用户在同一时段占用不同的带宽资源

时分复用：

> 将时间划分为一段段等长的时分复现复用帧（TDM），每一个时分复用的用户在TDM帧中占用固定序号的时隙。例：ABCD四个用户，每一个用户所占用的频段，以ABCD为周期间隙性的出现。所有用户在不同的时间占用相同的频带宽度。
>
> 每一个时分复用帧的长度不变，用户越多，每一个用户分到的时隙宽度就越小![Screenshot_20220310_162808](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220310_162808.jpg)

![Screenshot_20220310_162909](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220310_162909.jpg)

统计时分复用：

> 一个用户对分配的子信道的利用率不高，某一时间段暂时无传输数据（打字，浏览网页），占用信道，浪费了空闲资源，其他用户也无法使用暂时空闲的资源，这时候我们可以把低速用户的传输数据集中起来（利用集中器），然后通过高速线路传输出去。 使用STDM帧
>
> STDM帧时隙数小于用户数（谁空闲就没有谁），STDM帧按需动态分配时隙，不是按周期出现的，所以叫做异步时分复用，普通的叫做同步时分复用
>
> * STDM帧中的时隙并不是固定的分给某个用户，所以每个时隙中还得加入用户地址信息，开销增加
>
>   ![Screenshot_20220310_163014](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220310_163014.jpg)

* TDM帧和STDM帧都是物理层传送的比特流中所划分的帧。这种帧和数据链路层中的帧使完全不同的概念

波分复用（WDM）：

> 指光的频分复用
>
> 一根光纤上同时传输多个频率很接近的光载波信号
>
> 传输速率相同的光载波，经过光调制器，变换光的波长到一个范围，每个光载波相距1nm，经过光复用器（合波器）在一根光纤中传输，然后到了指定位置再经过分用器，恢复光载波原来的波长，到达终点。

码分复用（CDM）：

> 也称码分多址（CDMA）。
>
> 每一个用户在同一时间使用同样的频带进行通信。由于各用户使用经过挑选的不同码型，因此各用户之间不会进行干扰。
>
> 每一个比特时间再划分为m个短的间隔，称为码片。通常m=8或者64
>
> 一个站要发送1，就发送自己的m码片序列，要发送0就发送m码片序列的反码
>
> ---
>
> 以8为例，S站的8码片序列为（00011011）
>
> 当S站发送比特1时，它就发送序列00011011 ，发送0时，它就发送11100100
>
> S站的发送数据率为b bit/s ,实际上是 mb bit/s ，频带宽度也是之前的m倍，即扩频
>
> * CDMA系统的特点就是每一站的码片序列都各不相同，而且需要必须相互正交，即向量内积为0
> * 码片序列中的1视为 1，0 时为-1 
> * 码片向量和码片向量自己的规格内积为1，和反码向量内积为0

CDMA系统的运行流程：

X站要接收S站发送的数据，**X站就必须知道S站特有的码片序列**，X站要使用它得到的码片向量S与接收到的未知信号进行求内积运算。

X站收到的信号是所有站的发送的信号，X站用已知的码片向量S去和所有的信号求内积运算，因为不同站的码片序列全部都是正交的，所以除了S站发送的信号，其他站发送的信号内积都为0；其中S站发送比特1时，内积结果是+1，发送比特0时，内积结果为-1

![Screenshot_20220310_163115](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220310_163115.jpg)

宽带接入技术：

> 用户要连接到因特网，必须先连接到某个ISP，以便获得上网所需的IP地址。
>
> 从宽带接入的媒体来看，分为两类：有线宽带接入，另一类是无限宽带接入

ADSL技术：

非对称数字用户线ADSL技术用数字技术对现有的模拟电话用户线进行改造，使它能够承载宽带数字业务。

ADSL技术把0-4khz的低端频谱留给传统电话使用，高端频谱留给用户上网使用。

由于用户上网主要是下载各种文档，信息量并不大，因此ADSL下行（从ISP到用户）带宽远远大于上行（从用户到ISP）带宽，所以是非对称的。

![Screenshot_20220310_163228](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220310_163228.jpg)

*  ADSL的传输距离取决于数据率和用户线的路径（用户线越细，信号传输衰减越快），还与用户线上的信噪比密切相关

ADSL还需要在用户线的两端各安装一个ADSL调解器。

我国采用 离散多音调DMT调制技术。

> 采用频分复用技术，把40kHz以上一直到1.1MHz的高端频谱划分为许多子信道，其中25各子信道用于上行信道，249个子信道用于下行信道，并使用不同的载波进行数字调制。
>
> 由于用户线的具体条件差距巨大，ADSL采用自适应调制技术传送尽可能高的数据率。
>
> 但用户线两端的ADSL调制器受干扰情况不一样，不能保证固定的数据率。
>
> ​	ADSL调制器必须成对使用！ 调制器又称ATU

ADSL接入网分为三部分：数字用户线接入复用器（包含很多ADSL调制器），用户线，用户家中的设施

调制器一端放在电话端局，一端放在家中（远端）

用户电话通过电话分离器和远端连接到一起，经用户线到端局，再经过一个电话分离器到本地电话交换机。

* ADSL最大的好处就是 可以利用现有的电话网中的用户线，而不需要重新布线



光纤同轴混合网（HFC网）：

> 基于有线电视网的基础上开发出来的一种居民宽带接入网，除了可以传送电视节目还可以传输其他数据业务。
>
> HFC把原来有线电视网的电缆主干部分换成光纤，光纤从头端连接到光纤结点，光信号被转换为电信号，然后通过同轴电缆传送到用户家庭。

电视机能接收数字电视信号，需要机顶盒设备连接在同轴电缆和用户的电视机之间

为了方便用户上网和电视机从上行信道中交互获取数据，需要加一个电缆调制解调器。把计算机连接到电缆调制解调器就能上网。

* 一个用户，一条电话用户线，用户专用，最高数据率不变。
* 连接到电缆调制解调器时，在同轴电缆这一段用户所享用的最高数据率时不确定的，因为某个用户所能享受到的最高数据率取决于这段电缆现在正在有多少个用户正在传送数据。用户一多，直接寄

![Screenshot_20220310_163332](D:%5CHuawei%20Share%5CHuawei%20Share%5CScreenshot_20220310_163332.jpg)





# 数据链路层

> 数据链路层使用的信道类型：
>
> * 点对点信道：一对一，点对点的通信方式
> * 广播信道：一对多的广播通信方式。信道上连接的主机比较多，必须使用专用的共享信道协议来协调这些主机发送数据。
>
> 主要内容：
>
> 1. 数据链路层的点对点信道和广播信道的特点，以及使用的协议
> 2. 三个基本问题：封装成帧、透明传输和差错检测
> 3. 以太网MAC层硬件地址
> 4. 适配器、转发器、集线器、网桥、以太网交换机的作用和使用场合



## 点对点信道

链路：

> 是从一个结点到相邻结点的一段物理线路（有线或者无线），中间没有任何其他的交换结点。
>
> 计算机进行通信要经过很多个这样的链路，所以链路是路径的一部分

数据链路：

> 当需要再一条线路上传送数据时，除了物理线路，还必须要有通信协议来控制这些数据的传输。
>
> **如果把这些协议的硬件和软件加到链路上，就构成了数据链路。**
>
> 常见的是用网络适配器（里面有硬件也有软件）来实现这些协议，一般的适配器包括了数据链路层和物理层这两层的功能。

点对点数据链路层的协议数据单元--帧

数据链路层接收到帧 ---->取出数据上交给网络层

从网络层接收IP数据报--->加入必要控制信息封装成帧，发出给物理层



点对点信道数据链路层通信时的步骤：

1. 结点A拿到网络层传下来的IP数据报添加首尾部封装成帧
2. 把封装好的帧发送给结点B的数据链路层
3. 若结点B的数据链路层收到的数据没有差错，则从收到的帧中提取出IP数据报交给上面的网络层，否则就丢弃这个帧

数据链路层不考虑不考虑物理层的比特传输细节



## 三个基本问题

### 封装成帧

首部和尾部 :

> 首部和尾部的重要作用：帧定界（确定帧的界限），此外还包含必要控制信息
>
> 数据从首部开始发送，各种协议都对首部和尾部有明确规定。

为了提高帧的传送效率，帧的数据部分要尽可能的大于首部和尾部的长度

* 但是每一层都规定了所能传送的帧的数据部分的最大长度上限--最大传送单元MTU

例子：ASCII码文本文件传输

> 帧定界由特殊字符  帧定界符划分。
>
> ASCII码由7位编码，一共有128个不同的ASCII码，其中可打印的有95个，不可打印控制字符有33个。
>
> 控制字符SOH（start of Header）: 表示帧的首部  ，编码为01（0000001）
>
> EOT（end of Tail ）: 表示帧的结束，编码为04（0000100）

如果传输中发送故障，中断了发送，随后恢复正常，于是从头开始发送刚刚没有发送完的帧，接收端没有收到EOT帧，就丢弃掉刚刚没有接收完的帧，重新接收新的帧。



### 透明传输

帧传输过程中，最重要的就是，数据部分不能和帧定界符发生重复！

> 当传送的帧是用文本文件组成的帧时（字符都是从键盘输入的），数据部分肯定不可能出现EOT和SOH字符，所以不管输入什么，都可以放在帧里面传输过去，这样的传输叫做透明传输。

但是，当数据部分是非ASCII码文本文件时（二进制程序代码或计算机图像），情况就不一样了。

如果数据中的某个字节的二进制代码恰好和控制字符一样，就会错误的找到了帧的边界，就把剩下的数据丢弃了。



为了解决这个问题，就必须设法使数据中可能出现的控制字符SOH/EOT不被解释为控制字符。

方法：

> 在发送端发送帧中数据时在控制字符前面插入一个转义字符ESC（16进制编码为00011011），在接收端上传给网络层的时候，删除这个插入的转义字符。如果数据中还有和转义字符相同的，就在这个字符前面再加一个转义字符，接收端收到两个转义字符时，会删除掉第一个。
>
> 这种方法叫做字节填充或字符填充



## 差错检测

> 现实的通信链路不是理想的。在传输过程中可能会产生差错：1可能会变成0，0可能变成1，这叫做比特差错。
>
> 误码率：在一段时间内，传输错误的比特占所有传输比特的比率
>
> 误码率和信噪比有很大关系，提高信噪比，就可以使误码率降低。

#### 循环冗余检验CRC：

> 在发送端，先把数据划分成组，假设每个组k个比特，现假定传送的数据M = 101001（k=6）
>
> CRC运算就是在数据M的后面添加n位冗余码，然后构成一个帧发送出去。一共发送（k+n）位，虽然增大了开销，却可以进行差错检验。

n位冗余码：

> 用二进制的模2运算（进行加法时，1+1=0；0-1=1，不发生进位也不发生退位），进行2的n次方乘M的运算 ， 等价于在M后面添加n个0，得到（k+n）位的数除以收发双方事先商定的长度（n+1）位的除数P，得出的商是Q，余数是R（n位）

假定M=101001（k=6） ,假定除数P=1101（n=3） 模2运算后，Q=1101 余数R=001

> 熵并没有什么用，而余数R作为冗余码拼接在M后面发出去，
>
> 这种为了进行检错而添加的冗余码常称为帧检验冗余序列FCS  
>
> 加上FCS发出的帧为 ：1001001001   （2的n次方 * M +FCS）
>
> 这个2的n次方其实就是增长M的位数的，上例中，n=3 ， M就扩充了三位，然后再加上FCS

接收端收到的数据，以帧为单位，每一帧都进行CRC检验 

> 把收到的帧都除以P，然后检查余数R
>
> 无差错：R=0  接收
>
> R！= 0 ： 丢弃



FCS生成和CRC检验的速度非常快，由硬件处理的，不会耽误数据的厌恶。



#### 注意！

> CRC技术只能保证对接收帧的无差错的接收，即凡是再数据链路层中传输的数据，都能认为在传输的过程中没有差错，接收端丢弃的帧可视为没有接收。
>
> 但是，这不是”可靠传输“！
>
> 可靠传输的定义：发送端发送什么，接收端就接收什么

传输差错分为两种：

1. 比特差错
2. 传输差错：帧丢失、帧重复、帧失序

> 举例：
>
> 发送端发送三个帧 【1】【2】【3】
>
> 帧丢失：【1】【3】
>
> 帧重复：【1】【2】【2】【3】
>
> 帧失序：【1】【3】【2】

OSI的观点：

> 数据链路层上必须使用可靠传输，CRC的基础上增加，帧编号、确认、帧重传

现代互连网传输：

通信质量良好的有线传输链路： 

> 数据链路层协议不使用确认、重传机制，不提供可靠传输服务，如果出现差错，改正差错的任务交给上层协议（例如，运输层的TCP协议）

通信质量差的无线传输链路： 使用确认、重传机制。 



## PPP点对点协议：

> 互联网用户必须要连接到某个ISP才能接入到互联网。PPP协议就是用户计算机和ISP通信时所使用的数据链路层协议。

* 简单： 在TCP/IP协议族中，可靠传输由TCP协议负责，也是最复杂的，IP协议相对简单一点，所以在数据链路层不需要那么复杂，越简单越好，不需要纠错、不需要设置序号、不需要流量控制

* 封装成帧：加入帧定界符和必要控制信息

* 透明性：发什么，接收什么

* 多种网络层协议：PPP在物理链路上要接受多种网络协议

* 多种类型链路：PPP要在多种类型的链路上运行

* 差错检测：对接收的帧进行检测，丢弃由差错的帧

* 检测链接状态

* 最大传送单元：帧中数据部分有最大长度规定

* 网络层地址协商：提供一个机制使两个网络层的实体能够协商知道彼此的网络层地址

* 数据压缩协商：提供一种方法实现数据压缩算法

  

### PPP协议有三个组成部分

1. 一个将IP数据报封装到串行链路的方法。PPP既支持异步链路（无奇偶检验的8比特数据），也支持同步链路。

   IP数据报就是在PPP帧中就是其信息部分，受最大传送单元MTU限制

2. 一个用来建立、配置和测试数据链路连接的链路控制协议LCP。

3. 一套网络控制协议NCP

#### PPP帧格式

首部4个字段：

1. 标志字段：F （flag）：0x7E
2. 地址字段：A：0xFF
3. 控制字段：C：0x03    A、C字段均无信息
4. 协议字段：标识是什么数据
   1. 0x0021：IP数据报
   2. 0x021：LCP数据
   3. 0x8021：网络层的控制数据

中间：

​	为长度可变的IP数据报，不超过1500字节



尾部：

1. FCS:使用CRC的帧检验序列
2. F：标志序列



#### 字节填充

> 信息字段中出现与标志字段一样的比特组合

当PPP使用异步传输时：把转义字符定义为0x7D，并使用字节填充

1. 0x7E  转换为（0x7D，0x5E）
2. 0x7D 转换为 （0x7D，0x5D）
3. 出现ASCII码的控制字符（数值小于0x20），前面加0x7D

转义字符：加后缀

控制字符：加前缀



#### 零比特填充

PPP协议使用SONET/SDH链路时，使用同步传输（一连串的比特连续传输），而不是异步传输，此时采用零比特填充

作用：**可保证透明传输**

具体做法：

发送端：先扫描整个信息字段，只要发现有5个连续的1，就立即加入1个0.保证不会出现6个连续的1

接收端：从标志字符开始，5个连续的1后删除一个0



PPP协议的工作流程：

1. 用户个人电脑通过调制解调器呼叫路由器（点一下网络连接按钮），路由器即检测到调制解调器发出的载波信号，双方建立物理层连接，PPP进入**链路建立**状态，目的是建立链路层的LCP连接
2. 这时LCP开始协商一些配置选项，即发送LCP配置请求帧。配置请求有以下几种：
   1. 配置确认帧：所有选项都接受
   2. 配置否认帧：所有选项都理解但不能接受
   3. 配置拒绝帧：有的接受，有的不能接受，需要协商
3. 进入鉴别状态  ，使用鉴别协议鉴别。只允许传送LCP协议的分组、鉴别协议的分组以及监测链路质量的分组。
4. 成功，进入网络层协议
5. 网络层配置完了，链路处于**链路打开**，然后两个端点就可以发送分组了。还可以发送回送请求LCP分组、回送回答LCP分组
6. 数据传输结束。发送终止请求LCP分组，终止确认请求LCP分组。



#### 广播信道的数据链路层

局域网：网络为一个单位所有，且地理范围和站点数目均有限

局域网的优点：

1. 具有广播功能，一个站点可访问全网，主机可共享连接在局域网上的各种硬件和软件资源。
2. 便于系统的扩展和逐渐演变，各设备位置可灵活调整
3. 提高系统的可靠性、可用性和生存性

局域网按网络拓扑分类。

1. 星型网
2. 环形网
3. 总线网

共享信道要着重考虑一个问题：如何使众多用户能够合理而方便的共享通信媒体资源

静态划分信道：

​	频分复用、时分复用、波分复用和码分复用等，只要用户分配到了信道，就不会和其他的用户冲突。

​	但是代价太高，不适合局域网。

动态媒体接入：信道并非在用户通信时固定分配给用户

* 随机接入： 所有的用户可随机的发送信息，但如果有两个或更多的用户在同一时刻发送信息，产生碰撞，然后都发送失败了。
* 受控接入：用户不能随机的发送信息，而必须服从一定的控制。



#### 适配器

> 计算机与外界局域网连接是通过通信适配器进行的。
>
> 适配器本来就是主机内插入的一块网络接口板，称为网络接口卡NIC，即网卡

现在网卡都嵌入计算机主板了，不叫网卡了，叫适配器。

适配器上有处理器和存储器（RAM,ROM）

局域网到适配器 ，串行传输

适配器到计算机主板，并行传输

适配器的重要功能：数据串行传输和并行传输的转换，两边数据率不同，所以还需要进行缓存的芯片

错误的数据适配器直接丢掉，不用告诉计算机；正确的数据才告诉计算机

**计算机的硬件地址就在适配器的ROM中，计算机的软件地址（IP地址）在计算机存储器中**



为什么呢？

适配器接受到数据帧，检查一下数据帧的首部接收地址，是不是和自己存的计算机地址，一样就接收，不一样就不接受。

这就是广播通信接收数据的方式！

>  一台计算机发送数据，所以计算机都能收到



以太网采取的措施：

1. 无连接通信：不建立连接，直接发送数据，适配器对发送的帧也不编号，也不要求发回确认。

   但是同一时间只允许一台计算机发送数据

2. 使用曼彻斯特编码的信号



CSMA/CD协议的要点